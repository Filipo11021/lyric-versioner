<%# locals: (commits:, form_id:) %>
<div class="h-full overflow-y-auto border-x border-gray-200">
  <div class="sticky top-0 bg-gray-50 z-10 p-4">
    <h3 class="text-sm font-semibold mb-2 text-gray-900">
      History
    </h3>

    <div class="border-b border-gray-100">
      <div class="flex flex-col gap-3">
        <input
          type="text"
          name="commit_message"
          autocomplete="off"
          form="<%= form_id %>"
          placeholder="Describe your changes..."
          class="
            w-full px-3 py-2 text-sm border border-gray-300 rounded-md
            focus:outline-none focus:ring-2 focus:ring-blue-500
            focus:border-transparent
          "
        >

        <button
          type="submit"
          form="<%= form_id %>"
          class="
            w-full px-4 py-2 text-sm font-medium text-white bg-blue-600
            rounded-md hover:bg-blue-700 transition-colors shadow-sm
            focus:outline-none focus:ring-2 focus:ring-offset-2
            focus:ring-blue-500
          "
        >
          Save Version
        </button>
      </div>
    </div>
  </div>

  <div class="px-4 pb-6 flex flex-col gap-2">
    <% if commits.any? %>
      <div class="space-y-0">
        <% commits.each_with_index do |commit, index| %>
          <div class="relative pl-6 pb-6 last:pb-0 group">
            <% unless index == commits.size - 1 %>
              <div
                class="
                  absolute left-[9px] top-0 bottom-0 w-px bg-gray-200
                  group-last:hidden
                "
              ></div>
            <% end %>

            <div
              class="
                absolute left-[5px] top-4 size-2.5 rounded-full
                border-2 border-white ring-1 ring-gray-300 bg-white
                group-first:bg-blue-500 group-first:ring-blue-500
              "
            ></div>

            <div
              class="
                bg-white p-3 rounded-lg border border-gray-200 shadow-sm
                hover:border-blue-300 transition-colors cursor-pointer
              "
            >
              <div class="mb-1">
                <p class="text-sm font-medium text-gray-900 line-clamp-1">
                  <%= commit.message %>
                </p>
              </div>

              <div class="flex items-center justify-between text-xs text-gray-500">
                <div class="flex items-center gap-1">
                  <%= render "songs/icons/history_icon" %>
                  <span><%= time_ago_in_words(commit.timestamp) %> ago</span>
                </div>

                <span><%= commit.author_name %></span>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-10 text-gray-500 text-sm">
        No history yet.
      </div>
    <% end %>
  </div>
</div>
